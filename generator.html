<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hillside18 – Generátor odkazu pro hosta</title>
<style>
  :root{--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--bg:#f8fafc;--primary:#2563eb}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:860px;margin:24px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 12px}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:18px;margin-bottom:14px}
  label{display:block;font-weight:600;font-size:13px;margin:8px 0 4px}
  input{width:100%;padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px}
  .grid{display:grid;gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:1fr 1fr 1fr}
  @media (max-width:760px){.g2,.g3{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{appearance:none;border:1px solid #cbd5e1;background:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;text-decoration:none;text-align:center}
  .btn-primary{background:var(--primary);border-color:var(--primary);color:#fff}
  .muted{color:var(--muted);font-size:13px}
  .out{padding:10px 12px;border:1px dashed #cbd5e1;border-radius:10px;background:#fcfcfd;word-break:break-all}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef2ff;border:1px solid #c7d2fe;font-size:12px}
  .right{margin-left:auto}
  .radios label{display:inline-flex;align-items:center;gap:6px;font-weight:600;margin-right:14px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Generátor odkazu pro hosta <span class="pill">Hillside18</span></h1>
    <p class="muted">Vyplň údaje, zvol jazyk, klikni na „Vytvořit odkaz“ a pošli hostovi. Odkaz otevře <b>WP stránku</b> a do iframu se propsají kódy (Alfréd, dveře, apartmán) i stav (done/unpaid).</p>
  </div>

  <div class="card grid g3">
    <div>
      <label>Kód do Alfréda (nebo celá URL)</label>
      <input id="alf" placeholder="AB12CD nebo https://alfred.previo.app/login/AB12CD">
    </div>
    <div>
      <label>Kód dveří (4 číslice)</label>
      <div class="row">
        <input id="door" placeholder="1234" inputmode="numeric" maxlength="4" style="flex:1">
        <button class="btn" onclick="genDoor()">Vygenerovat</button>
      </div>
      <div class="muted">Generuje 4-místné kódy 1000–9999 (lze přepsat).</div>
    </div>
    <div>
      <label>Číslo apartmánu</label>
      <input id="apt" placeholder="5" inputmode="numeric">
    </div>
  </div>

  <div class="card">
    <div class="grid g2">
      <div>
        <label>Stav check-inu</label>
        <div class="row radios">
          <label><input type="radio" name="st" value="none" checked> Není dokončen</label>
          <label><input type="radio" name="st" value="done"> Dokončen</label>
          <label><input type="radio" name="st" value="unpaid"> Dokončen – zbývá zaplatit</label>
        </div>
      </div>
      <div>
        <label>Jazyk</label>
        <div class="row radios">
          <label><input type="radio" name="lang" value="cs" checked> Čeština</label>
          <label><input type="radio" name="lang" value="en"> English</label>
          <label><input type="radio" name="lang" value="de"> Deutsch</label>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <label>URL WordPress stránky (s koncovým „/“)</label>
    <input id="wpurl" placeholder="https://www.hillside18.cz/cs/check-in/">
    <div class="row" style="margin-top:8px">
      <button class="btn" onclick="saveDefaults()">Uložit jako výchozí</button>
      <button class="btn" onclick="loadDefaults()">Načíst výchozí</button>
      <button class="btn" onclick="clearAll()">Vymazat vše</button>
      <span class="muted right">Doporučeno: <code>https://www.hillside18.cz/cs/check-in/</code></span>
    </div>
  </div>

  <div class="card">
    <div class="row" style="gap:8px">
      <button class="btn btn-primary" onclick="build()">Vytvořit odkaz</button>
      <a id="open" class="btn btn-primary" target="_blank" rel="noopener">Otevřít WP odkaz</a>
      <button class="btn" onclick="copyLink()">Kopírovat</button>
      <a id="wa" class="btn" target="_blank" rel="noopener">WhatsApp</a>
      <a id="sms" class="btn" target="_blank" rel="noopener">SMS</a>
      <a id="mail" class="btn" target="_blank" rel="noopener">E-mail</a>
      <span id="status" class="muted right"></span>
    </div>
    <div id="out" class="out" style="margin-top:10px"></div>
  </div>
</div>

<script>
  const $ = id => document.getElementById(id);
  const radio = name => {
    const r = [...document.querySelectorAll('input[name="'+name+'"]')].find(x=>x.checked);
    return r ? r.value : null;
  };

  function genDoor(){
    $('door').value = String(Math.floor(1000 + Math.random() * 9000));
  }

  function build(){
    const wpraw = ($('wpurl').value || '').trim();
    const alfRaw = ($('alf').value || '').trim();
    const door = ($('door').value || '').trim();
    const apt = ($('apt').value || '').trim();
    const st = radio('st');
    const lang = radio('lang') || 'cs';

    if(!wpraw){ return status('Vyplň URL WordPress stránky.', true); }
    if(!alfRaw){ return status('Vyplň kód/URL Alfréda.', true); }
    if(!/^\d{4}$/.test(door)){ return status('Vyplň 4-místný kód dveří.', true); }
    if(!apt){ return status('Vyplň číslo apartmánu.', true); }

    // vždy koncové lomítko, aby WP nedělalo redirect bez query
    let base = wpraw.endsWith('/') ? wpraw : (wpraw + '/');

    // sestav parametry (URLSearchParams se postará o enkódování)
    const params = new URLSearchParams();
    if (lang && lang !== 'cs') params.set('lang', lang); // cs je výchozí, nemusíme posílat
    params.set('alf', alfRaw);   // může být kód i plná URL
    params.set('door', door);
    params.set('apt', apt);
    if (st === 'unpaid') params.set('unpaid', '1');
    else if (st === 'done') params.set('done', '1');

    const link = `${base}?${params.toString()}`.trim();

    // výstup + akce
    $('out').textContent = link;
    $('open').href = link;

    const enc = encodeURIComponent(link);
    $('wa').href  = `https://wa.me/?text=${enc}`;
    $('sms').href = `sms:?&body=${enc}`; // pozn.: chování se liší podle zařízení
    $('mail').href= `mailto:?subject=${encodeURIComponent('Hillside18 – informace k příjezdu')}&body=${enc}`;

    status('Odkaz připraven');
  }

  function copyLink(){
    const txt = ($('out').textContent || '').trim();
    if(!txt){ return status('Nejprve vytvoř odkaz.', true); }
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(txt).then(()=>status('Zkopírováno')).catch(()=>fallbackCopy(txt));
    } else {
      fallbackCopy(txt);
    }
  }
  function fallbackCopy(txt){
    const ta = document.createElement('textarea');
    ta.value = txt; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
    status('Zkopírováno');
  }

  function status(msg, err){
    $('status').textContent = msg;
    $('status').style.color = err ? '#b91c1c' : '#64748b';
    clearTimeout(status._t); status._t = setTimeout(()=>{$('status').textContent='';}, 2000);
  }

  function saveDefaults(){
    const obj = {
      wpurl: ($('wpurl').value || '').trim(),
      lang: radio('lang') || 'cs'
    };
    localStorage.setItem('hs.gen.defaults.v2', JSON.stringify(obj));
    status('Uloženo');
  }
  function loadDefaults(){
    try{
      const s = localStorage.getItem('hs.gen.defaults.v2');
      if(!s) return status('Nic k načtení');
      const d = JSON.parse(s);
      if(d.wpurl) $('wpurl').value = d.wpurl;
      if(d.lang){
        const r = document.querySelector('input[name="lang"][value="'+d.lang+'"]');
        if(r) r.checked = true;
      }
      status('Načteno');
    }catch(e){ status('Nelze načíst', true); }
  }
  function clearAll(){
    ['alf','door','apt'].forEach(id=>{$(id).value='';});
    $('out').textContent='';
    status('Vymazáno');
  }

  // inicializace – předvyplň WP URL a jazyk
  (function init(){
    try{
      const s = localStorage.getItem('hs.gen.defaults.v2');
      if(s){
        const d = JSON.parse(s);
        if(d.wpurl) { $('wpurl').value = d.wpurl; }
        if(d.lang){
          const r = document.querySelector('input[name="lang"][value="'+d.lang+'"]');
          if(r) r.checked = true;
        }
        return;
      }
    }catch(e){}
    $('wpurl').value = 'https://www.hillside18.cz/cs/check-in/';
  })();
</script>
</body>
</html>
